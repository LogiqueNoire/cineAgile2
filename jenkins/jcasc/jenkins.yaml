jenkins:
  systemMessage: "Jenkins Configured with Dynamic Agents"
  securityRealm:
    local:
      allowsSignup: false
      users:
        - id: admin
          password: admin

  authorizationStrategy:
    loggedInUsersCanDoAnything:
      allowAnonymousRead: false

  clouds:
    - docker:
        name: "docker-dind-cloud"
        dockerApi:
          dockerHost:
            uri: "tcp://172.18.0.1:2375"
        exposeDockerHost: true

        templates:

          # === Agente Docker CLI ===
          - name: "docker-agent"
            labelString: "docker"
            remoteFs: "/home/jenkins"
            instanceCapStr: 5
            dockerTemplateBase:
              image: "jenkins/inbound-agent:3352.v17a_fb_4b_2773f-2-jdk21"
              tty: true
              mounts:
                - "type=bind,source=/var/run/docker.sock,destination=/var/run/docker.sock"

              memoryLimit: 4096        # 4GB
              memorySwap: 5120         # 5GB
              cpuShares: 2048 
            retentionStrategy:
              idleMinutes: 10
            connector:
              attach:
                user: "jenkins"

          # === Agente Jenkins inbound (genÃ©rico) ===
          - name: "docker-agent2"
            labelString: "docker2"
            remoteFs: "/home/jenkins"
            instanceCapStr: 5
            dockerTemplateBase:
              image: "jenkins/inbound-agent:3352.v17a_fb_4b_2773f-2-jdk21"
              tty: true
            retentionStrategy:
              idleMinutes: 10

          # === Agente Git ===
          - name: "docker-agent3"
            labelString: "docker4"
            remoteFs: "/home/jenkins"
            instanceCapStr: 5
            dockerTemplateBase:
              image: "alpine/git:2.49.1"
              tty: true
            retentionStrategy:
              idleMinutes: 1

          # === Agente NodeJS ===
          - name: "node-agent"
            labelString: "node"
            remoteFs: "/home/jenkins"
            instanceCapStr: 3
            dockerTemplateBase:
              image: "node:iron-alpine3.22"
              tty: true
            retentionStrategy:
              idleMinutes: 5

          # === Agente AWS CLI ===
          - name: "aws-agent"
            labelString: "aws"
            remoteFs: "/home/jenkins"
            instanceCapStr: 3
            dockerTemplateBase:
              image: "amazon/aws-cli:2.32.6"
              tty: true
            retentionStrategy:
              idleMinutes: 5

          # === Agente Terraform ===
          - name: "terraform-agent"
            labelString: "terraform"
            remoteFs: "/home/jenkins"
            instanceCapStr: 3
            dockerTemplateBase:
              image: "hashicorp/terraform:1.14"
              tty: true
            retentionStrategy:
              idleMinutes: 5
# jobs:
#   - script: >
#       pipelineJob('front2') {
#         definition {
#           cpsScm {
#             scm {
#               git {
#                 branch('*/main')
#                 remote {
#                   url('${REPOSITORY_URL}')
#                 }
#               }
#             }
#             scriptPath('pipelines/frontend/Jenkinsfile')
#           }
#         }
#       }


tool:
  git:
    installations:
      - name: git
        home: /usr/bin/git